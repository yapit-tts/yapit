# Yapit Self-Hosting Configuration
# Copy this file to .env.selfhost and customize as needed.
# Most defaults work out of the box — just run `make self-host`.

# ============================================================================
# DATABASE
# ============================================================================

# Data persists across restarts. Tables are created on first start if missing.
DB_DROP_AND_RECREATE=0
DB_CREATE_TABLES=1
DB_SEED=1
SQLALCHEMY_ECHO=0

DATABASE_URL=postgresql+asyncpg://yapit:yapit@postgres:5432/yapit
POSTGRES_USER=yapit
POSTGRES_PASSWORD=yapit
POSTGRES_DB=yapit

# ============================================================================
# REDIS
# ============================================================================

REDIS_URL=redis://redis:6379/0

# ============================================================================
# BILLING (disabled for self-hosting — no usage limits)
# ============================================================================

BILLING_ENABLED=false

# ============================================================================
# CORS
# ============================================================================

# Frontend origin. Change if you serve on a different port.
CORS_ORIGINS='["http://localhost"]'

# ============================================================================
# CACHES (stored in Docker volumes, persist across restarts)
# ============================================================================

AUDIO_CACHE_TYPE=sqlite
AUDIO_CACHE_CONFIG__PATH=audio_cache
AUDIO_CACHE_CONFIG__MAX_SIZE_MB=1024

DOCUMENT_CACHE_TYPE=sqlite
DOCUMENT_CACHE_CONFIG__PATH=document_cache
DOCUMENT_CACHE_CONFIG__MAX_SIZE_MB=1024

EXTRACTION_CACHE_TYPE=sqlite
EXTRACTION_CACHE_CONFIG__PATH=extraction_cache
EXTRACTION_CACHE_CONFIG__MAX_SIZE_MB=1024

DOCUMENT_MAX_DOWNLOAD_SIZE=104857600

# ============================================================================
# IMAGE STORAGE (local filesystem, served by gateway)
# ============================================================================

IMAGE_STORAGE_TYPE=local
IMAGES_DIR=/data/images

# ============================================================================
# TTS
# ============================================================================

MAX_BLOCK_CHARS=250
SOFT_LIMIT_MULT=1.3
MIN_CHUNK_SIZE=40

# Worker replicas — increase if you have more CPU cores
KOKORO_CPU_REPLICAS=1
YOLO_CPU_REPLICAS=1
OMP_NUM_THREADS=4

# ============================================================================
# METRICS (optional — powers the dashboard via `make dashboard`)
# ============================================================================

METRICS_DATABASE_URL=postgresql://metrics:metrics@metrics-db:5432/metrics
LOG_DIR=gateway/logs

# ============================================================================
# STACK AUTH (authentication — these match the dev/init-db.sql seed)
# ============================================================================

STACK_AUTH_API_HOST=http://stack-auth:8102
STACK_AUTH_APP_HOST=http://stack-auth:5173
STACK_AUTH_PROJECT_ID=a12651bb-7824-459d-b424-21a0950ab902
STACK_AUTH_SERVER_KEY=ssk_0fqsegjvkkas2yr4eb78z58wr3v5r3z7hv11qtv4n2qsr
STACK_AUTH_CLIENT_KEY=pck_8ny111ccr9yyhty8vrmjk5ab32ezvcf19crck312j42p0

NEXT_PUBLIC_STACK_API_URL=http://localhost:8102
NEXT_PUBLIC_STACK_DASHBOARD_URL=http://localhost:8101
STACK_DATABASE_CONNECTION_STRING=postgres://yapit:yapit@postgres:5432/yapit
STACK_DIRECT_DATABASE_CONNECTION_STRING=postgres://yapit:yapit@postgres:5432/yapit
STACK_SERVER_SECRET=ssk_0fqsegjvkkas2yr4eb78z58wr3v5r3z7hv11qtv4n2qsr
STACK_SEED_INTERNAL_PROJECT_ALLOW_LOCALHOST=true
STACK_SEED_INTERNAL_PROJECT_SIGN_UP_ENABLED=true
STACK_RUN_MIGRATIONS=true
STACK_SKIP_SEED_SCRIPT=false

# ============================================================================
# MARKXIV (arXiv paper extraction — works out of the box, no API key needed)
# ============================================================================

MARKXIV_URL=http://markxiv:8080

# ============================================================================
# OPTIONAL: Premium features (require API keys)
# ============================================================================

# Google Gemini — enables AI document extraction (vision-based PDF/image processing)
# Get a key at https://ai.google.dev/gemini-api
# AI_PROCESSOR=gemini
# GOOGLE_API_KEY=your-key-here

# Inworld TTS — enables premium server-side voices
# Get a key at https://inworld.ai
# INWORLD_API_KEY=your-key-here

# RunPod — enables overflow TTS processing when local workers are busy
# Get a key at https://runpod.io
# RUNPOD_API_KEY=your-key-here
# KOKORO_RUNPOD_SERVERLESS_ENDPOINT=your-endpoint-id
# RUNPOD_REQUEST_TIMEOUT_SECONDS=25
